# EpayGov
**ПРОЕКТ: „Надграждане на съществуващите и изграждане на нови централни системи на електронното правителство с оглед на усъвършенстване на информационно-комуникационната среда за по-добро административно обслужване на гражданите и бизнеса"**

**рег. № К13-32-1/ 30.9.2013 г.**

Проектът се осъществява с финансовата подкрепа на Оперативна програма „Административен капацитет". Проектът се финансира от Европейския социален фонд и от държавния бюджет на Република България

[www.opac.government.bg](http://www.opac.government.bg/)

**Дейност 6:**

**"*****Надграждане на системата за електронни разплащания към централната и местна администрация, чрез разработване на единна входна точка за използване на наличните инструменти за плащане в Р. България и разработване на услуга за удостоверяване на време*****"**

Техническа спецификация за интеграция на АИС на държавната администрация със Средата за електронни разплащания

изготвена от консорциум „ТАКС МИ"

*версия 4.4, 05.04.2016 г.*

**\
**

**СЪДЪРЖАНИЕ:**

[1 Електронни документи (XML формат). 3](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639965)

[1.1...... Заявка за плащане  (R-10046_PaymentRequest)  3](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639966)

[1.1.1 Структура и състав на данните. 4](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639967)

[1.2...... Съобщение, че заявката за плащане не се приема (R-10052_UnacceptedPaymentRequestReceipt)  18](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639968)

[1.2.1 Структура и състав на данните. 18](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639969)

[1.3...... Съобщение, че заявката за плащане се приема (R-10055_PaymentRequestReceipt)  19](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639970)

[1.3.1 Структура и състав на данните. 20](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639971)

[2 Електронни документи (JSON формат). 20](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639972)

[2.1...... Заявка за плащане. 20](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639973)

[2.2...... Съобщение, че заявката за плащане не се приема. 22](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639974)

[2.3...... Съобщение, че заявката за плащане се приема. 22](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639975)

[3 Извикване на услуги  на средата.. 22](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639976)

[4 Услуги реализирани от средата.. 23](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639977)

[4.1...... Услуги за обмен на данни с АИС.. 23](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639978)

[4.1.1 Създаване на заявка за плащане (XML формат)  23](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639979)

[4.1.2 Създаване на заявка за плащане (JSON формат)  24](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639980)

[4.1.3 Запитване за заявки за плащане по идентификатор (XML формат)  25](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639981)

[4.1.4 Запитване за заявки за плащане по идентификатор (JSON формат)  26](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639982)

[4.1.5 Запиване за код за достъп до заявка за плащане. 26](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639983)

[4.1.6 Запитване за статус на заявки за плащане по идентификатор. 27](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639984)

[4.1.7 Отказване на заявка за плащане. 28](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639985)

[4.1.8 Отбелязване на заявка за плащане като платена. 28](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639986)

[4.1.9 Съобщение за промяна на статуса на заявка за плащане. 29](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639987)

[4.1.10 Плащане с виртуален ПОС.. 30](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639988)

[4.1.11 Визуализиране на платежно нареждане. 32](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639989)

[5 Тестова среда.. 32](file:///C:/Users/masenov/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/6718XH8C/TechSpec_epayments_integration_AIS_MTITS_TAXME_v%204%205_20190916.doc#_Toc447639990)

**\
**

|

АИС

 |

Административна информационна система

 |
|

ДПУ

 |

Доставчик на платежни услуги

 |
|

ЕАУ

 |

Електронни административни услуги

 |
|

НЕАУ

 |

Наредба за електронните административни услуги

 |
|

РОС

 |

Регистри за оперативна съвместимост на електронното правителство

(<http://www.egov.bg/ereg-public/rio/home.rg>)

 |
|

РИО

 |

Регистър на информационните обекти

 |
|

РРД

 |

Регистър на регистрите и данните

 |
|

УРИ

 |

Уникален регистров идентификатор

 |

1 Електронни документи (XML формат)
===================================

1.1 Заявка за плащане  (R-10046_PaymentRequest)
-----------------------------------------------

 Заявката за плащане е електронен документ в XML формат, чрез който се заявява плащане към **Средата**, отговарящ на изискванията на чл. 48 от НЕАУ.

|

![](file:///C:/Users/masenov/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)

 |

Фигура 1 Състав на данните в документ заявка за плащане

### 1.1.1 Структура и състав на данните

#### 1.1.1.1 Код на вид плащане

| Определение и предназначение |    Използва се за да се означи вид плащане към администратори на публични   вземания. В случаите, когато се заплаща такса за предоставяне на ЕАУ, обектът   се оставя празен.    |
|----------------------------------:|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|    Вид и състав на данните    | String |
|    Вид на информационния обект    | Стойност |
|    УРИ в РРД    |    Обектът трябва да бъде   заявен за вписване в РРД    |
|    УРИ в РИО    |    Обектът трябва да бъде   заявен за вписване в РИО    |
|    Указания за обработка    |    Попълва се в автоматичен режим от приложението, което е предназначено за   осигуряване на електронни плащания за публични вземания. В случаите на   заплащане на такса за административна услуга се оставя празен.    При приемане на заявката за плащане, стойността се извлича от документа и   Средата попълва кода на вид   плащане в реквизит 9 "Вид плащане" на "Платежно   нареждане/вносна бележка за плащане от/към бюджета" или в реквизити 9 и 13   "Вид плащане" "Платежно нареждане/вносна бележка за плащане   от/към бюджета многоредово".    |
|    Указания за валидация    |    Средата извършва следните проверки:   Стойността, която е попълнена трябва   да съответства на стойност от номенклатурата на кодовете за вид плащане. При   грешка, Средата връща съобщение,   че заявката не се приема. Съобщението включва УРИ и термина на грешката,   както ще бъдат вписани в РРД.   Идентификаторът на вида сметка, трябва   да започва с 8 (13-та позиция в IBAN). При несъответствие, Средата връща съобщение, че заявката   не се приема. Съобщението включва УРИ и термина на грешката , както са   вписани в РРД.    |
| Термини на грешки  | Попълнената стойност в елемента "Код на вид плащане", не съотвества на действащата номенклатура от стойности за код на вид плащане. Посочената банкове сметка не е левова сметка на администратор на публични вземания |

 |

#### 1.1.1.2 Вид валута
| \| Определение и предназначение \|    Използва се за да се означи вид плащане към администратори на публични   вземания\. В случаите, когато се заплаща такса за предоставяне на ЕАУ, обектът   се оставя празен\.    \|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \|\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-:\|\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\| |
| \|    Вид и състав на данните    \| String \|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| \|    Вид на информационния обект    \| Стойност \|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| \|    УРИ в РРД    \|    Обектът трябва да бъде   заявен за вписване в РРД    \|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| \|    УРИ в РИО    \|    Обектът трябва да бъде   заявен за вписване в РИО    \|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| \|    Указания за обработка    \|    Попълва се в автоматичен режим от приложението, което е предназначено за   осигуряване на електронни плащания за публични вземания\. В случаите на   заплащане на такса за административна услуга се оставя празен\.    При приемане на заявката за плащане, стойността се извлича от документа и   Средата попълва кода на вид   плащане в реквизит 9 "Вид плащане" на "Платежно   нареждане/вносна бележка за плащане от/към бюджета" или в реквизити 9 и 13   "Вид плащане" "Платежно нареждане/вносна бележка за плащане   от/към бюджета многоредово"\.    \|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| \|    Указания за валидация    \|    Средата извършва следните проверки:   Стойността, която е попълнена трябва   да съответства на стойност от номенклатурата на кодовете за вид плащане\. При   грешка, Средата връща съобщение,   че заявката не се приема\. Съобщението включва УРИ и термина на грешката,   както ще бъдат вписани в РРД\.   Идентификаторът на вида сметка, трябва   да започва с 8 \(13\-та позиция в IBAN\)\. При несъответствие, Средата връща съобщение, че заявката   не се приема\. Съобщението включва УРИ и термина на грешката , както са   вписани в РРД\.    \|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| \| Термини на грешки  \| Попълнената стойност в елемента "Код на вид плащане", не съотвества на действащата номенклатура от стойности за код на вид плащане\. Посочената банкове сметка не е левова сметка на администратор на публични вземания \|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |


#### 1.1.1.3 Сума на платежна операция

|

Определение и предназначение

 |

Размер на таксата или цената за услугата или размер на задължението по публично вземане или обща сума на платежната операция, когато заявката за плащане съдържа няколко кредитни превода.

 |
|

Вид и състав на данните

 |

Double

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

Възможно е стойността да се попълни както в автоматичен режим от АИС или от приложението, което е предназначено за осигуряване на електронни плащания за публични вземания, както и от служител в администрацията, когато таксата за услугата се заплаща в хода на предоставяне на услугата и зависи от експертна преценка.

При приемане на заявката за плащане, стойността се извлича от документа и **Средата** я попълва в реквизит (11) "Сума"на "Платежно нареждане/вносна бележка за плащане от/към бюджета " или в реквизит (11) "Обща сума""Платежно нареждане/вносна бележка за плащане от/към бюджета многоредово".

 |
|

Указания за валидация

 |

**Средата** извършва проверка за типа на данните. При несъответствие се издава съобщение за грешка, дефинирана с термин с УРИ в РРД 0006-000064, като DataType се заменя с "double".

При грешка, **Средата** връща съобщение, че заявката не се приема. Съобщението включва УРИ и термина на грешката, така както са вписани в РРД.

 |
|

Термини на грешки

 |

0006-000064 <Field> трябва да е от тип <DataType>.

 |

#### 1.1.1.4 Доставчик на електронни административни услуги

Данни за доставчик на ЕАУ или администратор на публични вземания, доколкото администраторите на публични вземания са също административни органи.

|

Определение и предназначени

 |

Описва данни за доставчика на електронни административни услуги. Доставчикът е или юридическо лице, регистрирано по българското законодателство или лице, упражняващо свободна професия, регистрирано в регистър БУЛСТАТ

Забележка: Обектът ще се използва и за данни на администратори на публични вземания, доколкото те също са административни органи.

 |
|

Вид и състав на данните

 |

0003-00

0229 (Вид на доставчик на електронни административни услуги)

0003-000008 (Основни данни за юридическо лице, клон на чуждестранно юридическо лице или едноличен търговец)

 |
|

Вид на информационния обект

 |

Сегмент

 |
|

УРИ в РРД

 |

0003-000010

 |
|

УРИ в РИО

 |

0009-000002

 |
|

Указания за обработка

 |

Следват се указанията за обработка на обекта 0009-000002, вписани в РИО

 |
|

Указания за валидация

 |

Следват се указанията за валидация на обекта 0009-000002, вписани в РИО

 |
|

Термини на грешки

 |

Използват се термините за грешки към обекта 0009-000002, вписани в РИО

 |

#### 1.1.1.5 Банкова сметка на доставчик на ЕАУ

|

Определение и предназначение

 |

Данни за банкова сметка на доставчик на ЕАУ, към която да бъде извършен превод на такса за административна услуга или задължение по публично вземане

 |
|

Вид и състав на данните

 |

0003-000746 BIC

0003-000747 IBAN

0003-000007 (Наименование на юридическо лице, клон на чуждестранно юридическо лице или едноличен търговец)

 |
|

Вид на информационния обект

 |

Сегмент

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

Възможно е обектът да се попълни както в автоматичен режим от АИС или от приложението, което е предназначено за осигуряване на електронни плащания за публични вземания, както и от служител в администрацията, когато таксата за услугата се заплаща в хода на предоставяне на услугата и зависи от експертна преценка.

При приемане на заявката за плащане, стойността IBAN се извлича от документа и **Средата** я попълва в реквизит 6 "IBAN на получателя" на "Платежно нареждане/вносна бележка за плащане от/към бюджета".

При приемане на заявката за плащане, стойността "Наименование на юридическо лице, клон на чуждестранно юридическо лице или едноличен търговец" се извлича от документа и **Средата** я попълва в реквизит 8 "BIC на банката на получателя" на "Платежно нареждане/вносна бележка за плащане от/към бюджета" или "Платежно нареждане/вносна бележка за плащане от/към бюджета многоредово".

При приемане на заявката за плащане, стойността BIC се извлича от документа и **Средата** я попълва в реквизит 9 "При банка - име на банката на получателя" на "Платежно нареждане/вносна бележка за плащане от/към бюджета" или "Платежно нареждане/вносна бележка за плащане от/към бюджета многоредово".

 |
|

Указания за валидация

 |

**Средата** извършва проверка за включването на задължителните обекти:

- BIC;

- IBAN;

- 0003-000007 (Наименование на юридическо лице, клон на чуждестранно юридическо лице или едноличен търговец).

При липсата на поне един от тях, връща съобщение, че заявката не се приема. Съобщението включва УРИ и термина на грешката, така както са вписани в РРД.

 |
|

Термини на грешки

 |

0006-000023 Попълването на секцията <Section> е задължително.

 |

#### 1.1.1.6 Получател на електронна административна услуга

|

Определение и предназначение

 |

Описва титуляр на електронното изявление, който е получател на електронната административна услуга.

 |
|

Вид и състав на данните

 |

0003-000045 (Основни данни за физическо лице, нерегистрирано по българското законодателство)

0003-000036 (Основни данни за физическо лице)

0003-000054 (Основни данни за чуждестранно юридическо лице)

0003-000008 (Основни данни за юридическо лице, клон на чуждестранно юридическо лице или едноличен търговец)

 |
|

Вид на информационния обект

 |

Сегмент

 |
|

УРИ в РРД

 |

0003-000056

 |
|

УРИ в РИО

 |

0009-000015

 |
|

Указания за обработка

 |

Следват се указанията за обработка на обекта 0009-000002, вписани в РИО

 |
|

Указания за валидация

 |

Следват се указанията за валидация на обекта 0009-000002, вписани в РИО

 |
|

Термини на грешки

 |

Използват се термините за грешки към обекта 0009-000002, вписани в РИО

 |

#### 1.1.1.7 Основание за плащане

|

Определение и предназначение

 |

Обща информация за вида на плащаното задължение (данъчно/митническо/осигурително или други задължения).

 |
|

Вид и състав на данните

 |

String

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

При плащания на митнически задължения се попълват точни данни за вида на плащането - митнически сборове, ДДС при внос, лихви и други. При плащане преди възникване на митническото задължение трябва да се посочи информация, че плащането е авансово, както и данни за вида и идентификацията на транспортното средство, с което се внася стоката. При учредяване на обезпечение с паричен депозит се дава точна информация за целта на обезпечението и митническото учреждение, пред което трябва да послужи, като ал. 9 не се прилага

При приемане на заявката за плащане, стойността "Основание за плащане" се извлича от документа и **Средата** я попълва в реквизит 13 "Основание за плащане" и ако е необходимо реквизит 14 "Още пояснения" на "Платежно нареждане/вносна бележка за плащане от/към бюджета" или съответно в  реквизит 15 или 16 на "Платежно нареждане/вносна бележка за плащане от/към бюджета многоредово". Полетата 13 и 14 в платежното нареждане общо не трябва да надвишават 70 символа.

 |
|

Указания за валидация

 |

**Средата** извършва проверка за задължителното попълване на обекта. В случай на грешка връща съобщение, че заявката не се приема. Съобщението включва УРИ и термина на грешката, така както са вписани в РРД.

 |
|

Термини на грешки

 |

0006-000023 Попълването на секцията <Section> е задължително.

 |

#### 1.1.1.8 Документ, породил задължението за плащане

|

Определение и предназначение

 |

Данни за документ, въз основа на който се извършва плащане чрез средата за електронни плащания

 |
|

Вид и състав на данните

 |

Код на вид документ, породил задължение за плащане

Номер на документ,  породил задължение за плащане

Дата на издаване на документ, породил задължение за плащане

 |
|

Вид на информационния обект

 |

Сегмент

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

Следват се указанията за обработка на изграждащите го обекти

 |
|

Указания за валидация

 |

**Средата** извършва проверка за задължителното попълване на обекта. В случай на грешка връща съобщение, че заявката не се приема. Съобщението включва УРИ и термина на грешката, така както са вписани в РРД.

 |
|

Термини на грешки

 |

0006-000023 Попълването на секцията <Section> е задължително.

 |

##### 1.1.1.8.1 Код на вид документ, породил задължение за плащане

|

Определение и предназначение

 |

Указва вида документ, породил задължението за плащане. Кодовете на видовете документи са определени от БНБ с УКАЗАНИЕ 03--2014 за съставяне на платежни документи.

 |
|

Вид и състав на данните

 |

String

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

Обектът трябва да бъде заявен за вписване в РРД

 |
|

УРИ в РИО

 |

Обектът трябва да бъде заявен за вписване в РИО

 |
|

Указания за обработка

 |

Стойността "код на вид документ, породил задължение за плащане" се извлича от заявката за плащане и се попълва в реквизит (15) "Вид и номер на документа, по който се плаща" на "Платежно нареждане/вносна бележка за плащане от/към бюджета" или в реквизит (17) "Платежно нареждане/вносна бележка за плащане от/към бюджета многоредово".

При задължения по сметки 7301, 7315, 7316 и 7318 на териториалните структури на Националната агенция за приходите (за приходите на централния бюджет; за приходите за социално-осигурителните фондове към НОИ, за приходите за НЗОК и за вноски и наказателни лихви за ДЗПО), задължително се попълва вид на документа с код 9.

 |
|

Указания за валидация

 |

Средата извършва следните проверки:

1. Дали стойността е попълнена.

2. Дали попълненият код отговаря на номенклатурата от кодове на видовете документи, породили задължението за плащане, която е определена от БНБ.

В случай на грешка връща съобщение, че заявката не се приема. Съобщението включва УРИ и термина на грешката, така както са вписани в РРД.

 |
|

Термини на грешки

 |

0006-000015   Полето <Field> от секцията <Section> трябва да е попълнено.

0006-000016 Полето <Field> може да заема само валидни стойности от <Nomenclature>.

 |

##### 1.1.1.8.2 Номер на документ,  породил задължение за плащане

|

Определение и предназначение

 |

Указва номер на документ, породил задължения за плащане

 |
|

Вид и състав на данните

 |

String

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

Стойността "номер на документ, породил задължения за плащане" се извлича от заявката за плащане и се попълва в реквизит (15) "Вид и номер на документа, по който се плаща" на "Платежно нареждане/вносна бележка за плащане от/към бюджета" или реквизит 17 "Платежно нареждане/вносна бележка за плащане от/към бюджета многоредово".

 |
|

Указания за валидация

 |

**Средата **проверява, дали е попълнена стойността "номер на документ, породил задължения за плащане"

В случай на грешка връща съобщение, че заявката не се приема. Съобщението включва УРИ и термина на грешката, така както са вписани в РРД.

**Задължителен контрол**** - **при вид на документа 2, 3 и 6 задължително се попълва и номер на документа.

 |
|

Термини на грешки

 |

0006-000015   Полето <Field> от секцията <Section> трябва да е попълнено.

 |

##### 1.1.1.8.3 Дата на издаване на документ, породил задължение за плащане

|

Определение и предназначение

 |

Указва датата на издаване на документ, породил задължения за плащане

 |
|

Вид и състав на данните

 |

Date

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

Обектът трябва да бъде заявен за вписване в РРД

 |
|

УРИ в РИО

 |

Обектът трябва да бъде заявен за вписване в РИО

 |
|

Указания за обработка

 |

При приемане на заявката за плащане, стойността "Дата на издаване на документ, породил задължения за плащане" се извлича от документа и **Средата** я попълва в реквизит (16) "Дата (ддммгггг) на документа" на "Платежно нареждане/вносна бележка за плащане от/към бюджета" или в реквизит 18 "Платежно нареждане/вносна бележка за плащане от/към бюджета многоредово".

 |
|

Указания за валидация

 |

Средата извършва следните проверки:

1. Дали е попълнена стойността "Дата на издаване на документ, породил задължения за плащане";

2. Датата на издаване на документ, породил задължения за плащане може да приема само стойности от тип дата. При несъответствие се издава съобщение за грешка, дефинирана с термин УРИ 0006-000014, като на <DateFormat> съответства формата „ДД.ММ.ГГГГ".

**Задължителен **контрол- при "вид на документа" 2, 3 и 6 задължително се попълва и "дата на документа".

 |
|

Термини на грешки

 |

0006-000015   Полето <Field> от секцията <Section> трябва да е попълнено.

0006-000014 (Полето <Field> не съдържа валидна дата. Дата трябва да е във формат <DateFormat>.)

 |

#### 1.1.1.9 Период, за който се отнася плащането

|

Определение и предназначение

 |

Указва период от време, за който се отнася плащането в случай на периодични плащания към бюджета

 |
|

Вид и състав на данните

 |

Начална дата на период, за който се отнася плащането

Крайна дата на период, за който се отнася плащането

 |
|

Вид на информационния обект

 |

Сегмент

 |
|

УРИ в РРД

 |

Обектът трябва да бъде заявен за вписване в РРД

 |
|

УРИ в РИО

 |

Обектът трябва да бъде заявен за вписване в РИО

 |
|

Указания за обработка

 |

Следват се указанията за обработка на изграждащите го обекти

 |
|

Указания за валидация

 |

Средата извършва следните проверки:

1. при попълнено поле "вид на документа" 1, 2, 4 и 5 задължително се попълва "период, за който се плаща";

2. "от дата" - началната дата трябва да бъде по-малка или равна на "до дата"- крайната

дата.

 |
|

Термини на грешки

 |  |

##### 1.1.1.9.1 Начална дата на период, за който се отнася плащането

|

Определение и предназначение

 |

Указва началната дата на период, за който се отнася плащането

 |
|

Вид и състав на данните

 |

Date

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

Стойността "Начална дата на период, за който се отнася плащането" се извлича от заявката за плащане и сепопълва в реквизит (16) "Дата (ддммгггг) на документа -- от дата" на "Платежно нареждане/вносна бележка за плащане от/към бюджета" или реквизит (19) "Платежно нареждане/вносна бележка за плащане от/към бюджета многоредово".

 |
|

Указания за валидация

 |

Средата извършва следните проверки:

1. Дали е попълнена стойността "Начална дата на период, за който се отнася плащането", когато кодът на вид документ е 2,3 или 6;

2. Начална дата на период, за който се отнася плащането може да приема само стойности от тип дата. При несъответствие се издава съобщение за грешка, дефинирана с термин УРИ 0006-000014, като на <DateFormat> съответства формата „ДД.ММ.ГГГГ".

 |
|

Термини на грешки

 |

0006-000015   Полето <Field> от секцията <Section> трябва да е попълнено.

0006-000014 Полето <Field> не съдържа валидна дата. Дата трябва да е във формат <DateFormat>.

 |

##### 1.1.1.9.2 Крайна дата на период, за който се отнася плащането

|

Определение и предназначение

 |

Указва крайната дата на период , за който се отнася плащането

 |
|

Вид и състав на данните

 |

Date

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

Обектът трябва да бъде заявен за вписване в РРД

 |
|

УРИ в РИО

 |

Обектът трябва да бъде заявен за вписване в РИО

 |
|

Указания за обработка

 |

Стойността "Крайна дата на период, за който се отнася плащането" се извлича от заявката за плащане и се попълва в реквизит (16) "Дата (ддммгггг) на документа -- до дата" на "Платежно нареждане/вносна бележка за плащане от/към бюджета" или реквизит (19) "Платежно нареждане/вносна бележка за плащане от/към бюджета многоредово".

 |
|

Указания за валидация

 |

Средата извършва следните проверки:

1. Дали е попълнена стойността "Крайна дата на период , за който се отнася плащането", когато кодът на вид документ е 2,3 или 6;

2. Крайната дата на период, за който се отнася плащането може да приема само стойности от тип дата. При несъответствие се издава съобщение за грешка, дефинирана с термин УРИ 0006-000014, като на <DateFormat> съответства формата „ДД.ММ.ГГГГ".

 |
|

Термини на грешки

 |

0006-000015   Полето <Field> от секцията <Section> трябва да е попълнено.

0006-000014 Полето <Field> не съдържа валидна дата. Дата трябва да е във формат <DateFormat>.

 |

#### 1.1.1.10 Дата на валидност на заявката за плащане

|

Определение и предназначение

 |

Указва крайната дата, до която е валидна заявката за плащане

 |
|

Вид и състав на данните

 |

DateTime

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

След изтичане на датата на валидност на заявката за плащане, нейният статус автоматично се променя от Средата на „Изтекла".

 |
|

Указания за валидация

 |

Средата извършва следните проверки:

1. Дали е попълнена стойността "Дата на валидност на заявката за плащане";

2. Дата на валидност на заявката за плащане може да приема само стойности от тип дата. При несъответствие се издава съобщение за грешка, дефинирана с термин УРИ 0006-000014, като на <DateFormat> съответства формата „ДД.ММ.ГГГГ".

 |
|

Термини на грешки

 |

0006-000015   Полето <Field> от секцията <Section> трябва да е попълнено.

0006-000014 Полето <Field> не съдържа валидна дата. Дата трябва да е във формат <DateFormat>.

 |

#### 1.1.1.11 Допълнителна информация в заявка за плащане

|

Определение и предназначение

 |

Възможност за въвеждане на информация за плащането, която не е предвидена в други полета

 |
|

Вид и състав на данните

 |

String

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

Полето не е задължително, при необходимост съдържа допълнителна информация или указания във връзка с заявката за плащане.

 |
|

Указания за валидация

 |

Няма

 |
|

Термини на грешки

 |

Няма

 |

#### 1.1.1.12 УРИ на наименованието на административна услуга

|

Определение и предназначение

 |

Уникален регистров идентификатор, издаден от Списъка с унифицираните наименования на административните услуги

 |
|

Вид и състав на данните

 |

String

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

0003-000142

 |
|

УРИ в РИО

 |

0008-000077

 |
|

Указания за обработка

 |

Незадължително поле.

 |
|

Указания за валидация

 |

Няма

 |
|

Термини на грешки

 |

Няма

 |

#### 1.1.1.13 УРИ на административна структура в Административния регистър

|

Определение и предназначение

 |

Уникален регистров идентификатор на административна структура в Административния регистър.

 |
|

Вид и състав на данните

 |

String

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

Незадължително поле.

 |
|

Указания за валидация

 |

Няма

 |
|

Термини на грешки

 |

Няма

 |

#### 1.1.1.14 Електронен адрес за уведомяване за променен статус на заявка за плащане

|

Определение и предназначение

 |

Електронен адрес, на който се изпраща съобщение за променен статус на заявка за плащане

 |
|

Вид и състав на данните

 |

String

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

Незадължително поле.

 |
|

Указания за валидация

 |

Средата извършва проверка дали полето съдържа валиден URL адрес

 |
|

Термини на грешки

 |

0006-000064 <Field> трябва да е от тип <DataType>

 |

#### 1.1.1.15 0009-000003 УРИ на документ, вписан в регистъра на информационните обекти

|

Определение и предназначени

 |

Уникален регистров идентификатор на документ, вписан в регистъра на информационните обекти

Забележка: Обектът ще се използва за служебни цели: Чрез XPAT заявка може да бъдат извлечени данните от сегмента и идентифицирана схемата, срещу която де се валидира документа.

 |
|

Вид и състав на данните

 |

0003-000016 (УРИ на партида)

 |
|

Вид на информационния обект

 |

Сегмент

 |
|

УРИ в РРД

 |

0003-000016

 |
|

УРИ в РИО

 |

0009-000003

 |
|

Указания за обработка

 |

Следват се указанията за обработка на обекта 0009-000003, вписани в РИО

 |
|

Указания за валидация

 |

Следват се указанията за валидация на обекта 0009-000003, вписани в РИО

 |
|

Термини на грешки

 |

Използват се термините за грешки към обекта 0009-000003, вписани в РИО

 |

#### 1.1.1.16 0008-000007 Наименование на документ, вписан в регистъра на информационните обекти

За служебни цели.

|

Определение и предназначени

 |

Наименование на документ, вписан в регистъра на информационните обекти

 |
|

Вид и състав на данните

 |

единична

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

0003-000015

 |
|

УРИ в РИО

 |

0008-000007

 |
|

Указания за обработка

 |

Следват се указанията за обработка на обекта 0008-000007, вписани в РИО

 |
|

Указания за валидация

 |

Следват се указанията за валидация на обекта 0008-000007, вписани в РИО

 |
|

Термини на грешки

 |

Използват се термините за грешки към обекта 0008-000007, вписани в РИО

 |

1.2 Съобщение, че заявката за плащане не се приема  (R-10052_UnacceptedPaymentRequestReceipt)
---------------------------------------------------------------------------------------------

Съобщението ще представлява електронен документ в XML формат, отговарящ на изискванията на чл. 48 от НЕАУ.

Съобщението ще се връща в същата комуникационна сесия, в която е извършена заявката за плащане или заявка за плащане (многоредова).

|

![](file:///C:/Users/masenov/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg)

 |

Фигура 3 Състав на данните в съобщение, че заявката за плащане не се приема

### 1.2.1 Структура и състав на данните

#### 1.2.1.1 Грешка, допусната в заявка за плащане

|

Определение и предназначение

 |

Указва вида и наименованието на грешка допусната в заявка за плащане

 |
|

Вид и състав на данните

 |

0003-000074 (Наименование на термин)

0003-000073 (УРИ на термин)

 |
|

Вид на информационния обект

 |

Сегмент

 |
|

УРИ в РРД

 |

Обектът трябва да бъде заявен за вписване в РРД

 |
|

УРИ в РИО

 |

Обектът трябва да бъде заявен за вписване в РИО

 |
|

Указания за обработка

 |

няма

 |
|

Указания за валидация

 |

Валидацията се извършва в съответствие с приложената в полето "XML дефиниция" XSD схема. При невалидна структура се извежда съобщение за грешка с УРИ на термин 0006-000069.

 |
|

Термини на грешки

 |

0006-000069 Невалидна структура на обекта съгласно XML дефиницията му, вписана в регистъра на информационните обекти

 |

#### 1.2.1.2 Време на обработване на заявка за плащане

|

Определение и предназначение

 |

Указва времето на обработване на заявката за плащане

 |
|

Вид и състав на данните

 |

DateTime

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

Няма

 |
|

Указания за валидация

 |

Няма

 |
|

Термини на грешки

 |

Няма

 |

#### 1.2.1.3 Заявка за плащане

Обектът е описан в точка 1.1 Заявка за плащане.

#### 1.2.1.4 Заявка за плащане (многоредова)

Обектът е описан в точка 1.2 Заявка за плащане (многоредова).

#### 1.2.1.5 0009-000003 УРИ на документ, вписан в регистъра на информационните обекти

Обектът е описан в т. 1.1.1.15 УРИ на документ, вписан в регистъра на информационните обекти.

#### 1.2.1.6 0008-000007 Наименование на документ, вписан в регистъра на информационните обекти

За служебни цели.

Обектът е описан 1.1.1.16 Наименование на документ, вписан в регистъра на информационните обекти.

1.3 Съобщение, че заявката за плащане се приема (R-10055_PaymentRequestReceipt)
-------------------------------------------------------------------------------

Съобщение, че заявката за плащане се приема е електронен документ в XML формат, чрез който се заявява плащане към **Средата**, отговарящ на изискванията на чл. 48 от НЕАУ.

Съобщението ще се връща в същата комуникационна сесия, в която е извършена заявката за плащане.

|

![](file:///C:/Users/masenov/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg)

 |

Фигура 4 Състав на данните в съобщение, че заявката за плащане се приема

### 1.3.1 Структура и състав на данните

#### 1.3.1.1 Идентификатор на заявка за плащане

|

Определение и предназначение

 |

Уникален идентификатор на заявката за плащане, който се присвоява от Средата

 |
|

Вид и състав на данните

 |

String

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

Няма

 |
|

Указания за валидация

 |

Няма

 |
|

Термини на грешки

 |

Няма

 |

#### 1.3.1.2 Време на регистриране на заявка за плащане

|

Определение и предназначение

 |

Указва времето на регистрация на заявката за плащане

 |
|

Вид и състав на данните

 |

DateTime

 |
|

Вид на информационния обект

 |

Стойност

 |
|

УРИ в РРД

 |

*Обектът трябва да бъде заявен за вписване в РРД*

 |
|

УРИ в РИО

 |

*Обектът трябва да бъде заявен за вписване в РИО*

 |
|

Указания за обработка

 |

Няма

 |
|

Указания за валидация

 |

Няма

 |
|

Термини на грешки

 |

Няма

 |

#### 1.3.1.3 0009-000003 УРИ на документ, вписан в регистъра на информационните обекти

Обектът е описан в т. 1.1.1.15 УРИ на документ, вписан в регистъра на информационните обекти.

#### 1.3.1.4 0008-000007 Наименование на документ, вписан в регистъра на информационните обекти

За служебни цели.

Обектът е описан 1.1.1.16 Наименование на документ, вписан в регистъра на информационните обекти.

2 Електронни документи (JSON формат)
====================================

2.1 Заявка за плащане
---------------------

{

    "aisPaymentId": "<aisPaymentId>",   

    "serviceProviderName": "<serviceProviderName>",

    "serviceProviderBank": "<serviceProviderBank>",

    "serviceProviderBIC": "<serviceProviderBIC>",

    "serviceProviderIBAN": "<serviceProviderIBAN>",

    "currency": "<currency>",

    "paymentTypeCode": "<paymentTypeCode>",

    "paymentAmount": "<paymentAmount>",

    "paymentReason": "<paymentReason>",

    "applicantUinTypeId": "<applicantUinTypeId>",

    "applicantUin": "<applicantUin>",

    "applicantName": "<applicantName>",

    "paymentReferenceType": "<paymentReferenceType>",

    "paymentReferenceNumber": "<paymentReferenceNumber>",

    "paymentReferenceDate": "<paymentReferenceDate>",

    "expirationDate": "<expirationDate>",

    "additionalInformation": "<additionalInformation>",

    "administrativeServiceUri": "<administrativeServiceUri>",

    "administrativeServiceSupplierUri": "<administrativeServiceSupplierUri>",

    "administrativeServiceNotificationURL": "<administrativeServiceNotificationURL>",

}

Описание на полетата:

-   aisPaymentId: идентификатор на задължението за плащане в АИС на доставчика на ЕАУ;
-   serviceProviderName(*): доставчик на ЕАУ;
-   serviceProviderBank(*): име на банката, в която е сметката на доставчика на ЕАУ;
-   serviceProviderBIC(*): BIC код на сметката на доставчика на ЕАУ;
-   serviceProviderIBAN(*): IBAN код на сметката на доставчика на ЕАУ;
-   currency(*): валута в която се плаща задължението (три символа, пр. "BGN");
-   paymentTypeCode: код на плащане;
-   paymentAmount(*): сума на задължението (десетичен разделител ".", до 2 символа след десетичния разделител, пр. "2.33");
-   paymentReason(*): основание за плащане;
-   applicantUinTypeId(*): тип на идентификатора на задължено лице ("1", "2" или "3" -> ЕГН = 1, ЛНЧ = 2, БУЛСТАТ = 3);
-   applicantUin(*): идентификатор на задължено лице;
-   applicantName(*): име на задължено лице;
-   paymentReferenceType: тип на документ (референтен документ за плащане);
-   paymentReferenceNumber(*): номер на документ (референтен документ за плащане);
-   paymentReferenceDate(*): дата на документ (референтен документ за плащане);
-   expirationDate(*): дата на изтичане на заявката за плащане;
-   additionalInformation: допълнителна информация;
-   administrativeServiceUri: УРИ на ЕАУ;
-   administrativeServiceSupplierUri: УРИ на доставчик на ЕАУ;
-   administrativeServiceNotificationURL: URL за нотификации при смяна на статус на задължение.

Забележка: Полетата отбелязани със (*) са задължителни. Всички дати са в ISO 8601 формат.

2.2 Съобщение, че заявката за плащане не се приема
--------------------------------------------------

{

        "validationTime": "<validationTime>",

        "errors": [

                        "error1", "error2", "error3", ...

            ]

}

Описание на полетата:

-   validationTime -- времето на обработване на заявката за плащане в ISO 8601 формат;
-   errors -- списък с грешки допуснати в заявката за плащане.

2.3 Съобщение, че заявката за плащане се приема
-----------------------------------------------

{

        "id": "<id>",

        "registrationTime": "<registrationTime>"

}

Описание на полетата:

-   id - идентификатор на заявка за плащане;
-   registrationTime -- време на регистрация на заявката за плащане ISO 8601 формат.

3 Извикване на услуги  на средата
=================================

Извикването на услуги на средата се извършва чрез HTTP POST заявка на адрес посочен в полето URL на услугата.

При всяко извикване на услуга се подават три параметъра:

1. clientId -- уникален идентификатор на клиента на средата

2. hmac -- hmac-sha256 код изчислен върху полето data

3. data -- данни за предаваното съобщение.

Параметрите се подават в HTTPS POST заявката в Internet media type формат "application/x-www-form-urlencoded; charset=UTF-8".

Данните за предаваното съобщение в полето "data" се изчисляват по следния начин:

1. Прави се битова репрезентация с енкодинг UTF-8 на JSON стринга на предаваното съобщение описан в поле Data Params на услугата;

2. Битовата поредица се конвертира като Base64 стринг, който се подава в полето "data".

HMAC-SHA256 кода на предаваното съобщение (data) се изчислява по следния начин:

1. Прави се битова репрезентация с енкодинг UTF-8 на стринга "таен ключ" (secret) предоставен на клиента

2. Прави се битова репрезентация с енкодинг UTF-8 на стринга в полето "data"

3. Използвайки битовите репрезентации на "тайният ключ" и на "data" се изчислява бинарния HMAC-SHA256 код, като се използва функция за хеширане SHA-256

4. Битовата поредица генерирана от алгоритъма се конвертира като Base64 стринг, който се подава в полето "hmac"

Ако се извика услуга с несъществуващ clientId  или ако при извикване на услуга калкулирания от средата HMAC-SHA256 не съответства на подадения в полето hmac  се връща грешка HTTP 401 Unauthorized.

Резултатът от услугата се връща от средата като JSON стринг описан в поле Response Content на услугата.

4 Услуги реализирани от средата
===============================

4.1 Услуги за обмен на данни с АИС
----------------------------------

### 4.1.1 Създаване на заявка за плащане (XML формат)

|

Title

 |

Създаване на заявка за плащане

 |
|

Description

 |

Услугата създава заявка за плащане в средата за е-плащания.

Забележка: Когато aisPaymentId съдържа стойност, която съвпада с вече регистрирана заявка за плащане със статус PENDING,  не се създава нова заявка за плащане, а се актуализират данните с подадените. Ако статусът е различен от PENDING заявката не се приема.

 |
|

URL

 |

[https://serviceUrl/api/v1/eService/payment](https://serviceurl/api/v1/eService/payment)

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

{

 requestXml: "<PaymentRequest.xml>",

    aisPaymentId: "<aisPaymentId>"

}

 |
|

Data Params Description

 |

requestXml - XML документ от тип "ЗАЯВКА ЗА ПЛАЩАНЕ"

aisPaymentId - идентификатор на задължението за плащане в АИС на доставчика на ЕАУ (незадължително)

 |
|

Response Content

 |

{

  unacceptedReceiptXml: "<PaymentRequestUnacceptedReceipt.xml>",

   acceptedReceiptXml: "<PaymentRequestAcceptedReceipt.xml>"

}

 |
|

Response Content Description

 |

unacceptedReceipt - XML документ от тип "СЪОБЩЕНИЕ, ЧЕ ЗАЯВКАТА ЗА ПЛАЩАНЕ НЕ СЕ ПРИЕМА" (има стойност само ако заявката не е приета)

acceptedReceipt - XML  документ от тип "СЪОБЩЕНИЕ, ЧЕ ЗАЯВКАТА ЗА ПЛАЩАНЕ СЕ ПРИЕМА" (има стойност само ако заявката е успешно приета)

 |
|

Errors

 |

При невалидна структура на документ "ЗАЯВКА ЗА ПЛАЩАНЕ"  се връща грешка HTTP 400  BAD REQUEST

 |

### 4.1.2 Създаване на заявка за плащане (JSON формат)

|

Title

 |

Създаване на заявка за плащане

 |
|

Description

 |

Услугата създава заявка за плащане в средата за е-плащания.

Забележка: Когато aisPaymentId в JSON документа от тип "ЗАЯВКА ЗА ПЛАЩАНЕ" съдържа стойност, която съвпада с вече регистрирана заявка за плащане със статус PENDING,  не се създава нова заявка за плащане, а се актуализират данните с подадените. Ако статусът е различен от PENDING заявката не се приема.

 |
|

URL

 |

[https://serviceUrl/api/v1/eService/paymentJson](https://serviceurl/api/v1/eService/paymentJson)

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

JSON документ от тип "ЗАЯВКА ЗА ПЛАЩАНЕ"

 |
|

Data Params Description

 |  |
|

Response Content

 |

{

    "acceptedReceiptJson",

    "unacceptedReceiptJson"

}

 |
|

Response Content Description

 |

unacceptedReceiptJson - JSON документ от тип "СЪОБЩЕНИЕ, ЧЕ ЗАЯВКАТА ЗА ПЛАЩАНЕ НЕ СЕ ПРИЕМА" (има стойност само ако заявката не е приета).

acceptedReceiptJson -- JSON документ от тип "СЪОБЩЕНИЕ, ЧЕ ЗАЯВКАТА ЗА ПЛАЩАНЕ СЕ ПРИЕМА" (има стойност само ако заявката е успешно приета).

 |
|

Errors

 |

При невалидна структура на документ "ЗАЯВКА ЗА ПЛАЩАНЕ"  се връща грешка HTTP 400  BAD REQUEST

 |

### 4.1.3 Запитване за заявки за плащане по идентификатор (XML формат)

|

Title

 |

Запитване за заявка за плащане  по идентификатор

 |
|

Description

 |

Услугата по списък с идентификатори връща списък със заявки за плащане

 |
|

URL

 |

[https://serviceUrl/api/v1/eService/paymentsById](https://serviceurl/api/v1/eService/paymentsById)

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

{

   requestIds: [

       "<id>"

   ]

}

 |
|

Data Params Description

 |

id  -- идентификатор на заявка за плащане

 |
|

Response Content

 |

{

    paymentRequests: [

      {

         id: "<id>",

    requestXml: "<PaymentRequest.xml>"

       }

    ]

}

 |
|

Response Content Description

 |

id -- идентификатор на заявка за плащане

requestXml - XML  документ от тип "ЗАЯВКА ЗА ПЛАЩАНЕ"

Ако в средата не съществува регистрирана заявка за плащане с дадено id  услугата ще върне празен стринг в полетo  requestXml

 |
|

Errors

 |

Няма

 |

### 4.1.4 Запитване за заявки за плащане по идентификатор (JSON формат)

|

Title

 |

Запитване за заявка за плащане  по идентификатор

 |
|

Description

 |

Услугата по списък с идентификатори връща списък със заявки за плащане

 |
|

URL

 |

[https://serviceUrl/api/v1/eService/paymentsByIdJson](https://serviceurl/api/v1/eService/paymentsByIdJson)

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

{

   requestIds: [

       "<id>"

   ]

}

 |
|

Data Params Description

 |

id  -- идентификатор на заявка за плащане

 |
|

Response Content

 |

{

paymentRequests: [

        {

            id: "<id>",

            requestJson

        }

    ]

}

 |
|

Response Content Description

 |

id -- идентификатор на заявка за плащане

requestJson - Json  документ от тип "ЗАЯВКА ЗА ПЛАЩАНЕ"

Ако в средата не съществува регистрирана заявка за плащане с дадено id  услугата ще върне празен стринг в полетo  requestJson

 |
|

Errors

 |

Няма

 |

### 4.1.5 Запиване за код за достъп до заявка за плащане

|

Title

 |

Запитване за код за достъп до заявка за плащане

 |
|

Description

 |

Методът връща код за достъп към заявка за плащане

 |
|

URL

 |

[https://serviceUrl/api/v1/eService/accessCode](https://serviceurl/api/v1/eService/accessCode)

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

{

   id:  "<id>"

}

 |
|

Data Params Description

 |

id -- идентификатор на заявка за плащане

 |
|

Response Content

 |

{

    accessCode: "<accessCode>"

}

 |
|

Response Content Description

 |

accessCode -- код за достъп до заявка за плащане

Ако в средата не съществува регистрирана заявка за плащане с даденото id  услугата ще върне празен стринг в полето accessCode

 |
|

Errors

 |

Няма

 |

### 4.1.6 Запитване за статус на заявки за плащане по идентификатор

|

Title

 |

Запитване за статус на заявки за плащане по идентификатор

 |
|

Description

 |

Услугата по списък с идентификатори връща списък със статуси на заявки за плащане

 |
|

URL

 |

[https://serviceUrl/api/v1/eService/paymentsStatus](https://serviceurl/api/v1/eService/paymentsStatus)

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

{

   requestIds: [

       "<id1>"

   ]

}

 |
|

Data Params Description

 |

id -- идентификатор на заявка за плащане

 |
|

Response Content

 |

{

    paymentStatuses: [

      {

          id: "<id>",

          status: "<status>",

          changeTime: "<datetime>"

      }

   ]

}

 |
|

Response Content Description

 |

id -- идентификатор на заявка за плащане

status -- статус на заявката за плащане, възможните стойности са: "PENDING" (Очаква плащане), "AUTHORIZED" (Получена е авторизация от виртуалния ПОС терминал), "ORDERED" (Плащането е наредено), "PAID" (Плащането е получено по сметката на доставчика), "EXPIRED" (Заявката за плащане е изтекла), "CANCELED" (Заявката за плащане е отказана от потребителя), "SUSPENDED" (Заявката за плащане е отказана от АИС)

changeTime  -- време на промяна на статуса на заявката за плащане в ISO 8601формат

Ако в средата за елемент от списъка не съществува регистрирана заявка за плащане с дадено id  услугата ще върне празен стринг в полетата status  и changeTime

 |
|

Errors

 |

Няма

 |

### 4.1.7 Отказване на заявка за плащане

|

Title

 |

Отказване на заявка за плащане

 |
|

Description

 |

Чрез метода АИС  при прекратяване на услугата, може да откаже регистрирана от него заявка за плащане

 |
|

URL

 |

[https://serviceUrl/api/v1/eService/suspendRequest](https://serviceurl/api/v1/eService/suspendRequest)

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

{

   id:  "<id>"

}

 |
|

Data Params Description

 |

id -- идентификатор на заявка за плащане

 |
|

Response Content

 |

Няма

 |
|

Response Content Description

 |

Няма

 |
|

Errors

 |

При невалиден идентификатор на заявка за плащане (id) се връща грешка HTTP 400 BAD REQUEST

 |

### 4.1.8 Отбелязване на заявка за плащане като платена

|

Title

 |

Отбелязване на заявка за плащане като платена

 |
|

Description

 |

Чрез метода АИС  може да промени статуса на заявка за плащане на платена (PAID)  в случай, че плащането е било извършено извън средата за електронни плащания.

ЗАБЕЛЕЖКА: Средата за електронни плащания ще изпрати съобщение „Съобщение за промяна на статуса на заявка за плащане".

 |
|

URL

 |

[https://serviceUrl/api/v1/eService/setStatusPaid](https://serviceurl/api/v1/eService/setStatusPaid)

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

{

   id: "<id>",

   paymentMethod: "<paymentMethodEnum>",

   paymentDescription: "<paymentDescription>"

}

 |
|

Data Params Description

 |

id -- идентификатор на заявка за плащане

paymentMethod -- 1 (Друг), 2 (На каса)

paymentDescription -- допълнително описание на извършеното плащане

 |
|

Response Content

 |

Няма

 |
|

Response Content Description

 |

Няма

 |
|

Errors

 |

При невалиден идентификатор на заявка за плащане (id) се връща грешка HTTP 400 BAD REQUEST

 |

### 4.1.9 Съобщение за промяна на статуса на заявка за плащане

|

Title

 |

Съобщение за промяна на статуса на заявка за плащане

 |
|

Description

 |

При създаване на заявка за плащане, която съдържа „Електронен адрес за уведомяване за променен статус на заявка за плащане" средата уведомява на посочения адрес чрез настоящето  съобщение за промяната на статуса

 |
|

URL

 |

URL - електронен адрес за уведомяване за променен статус на заявка за плащане

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

{

      id: "<id>",

      status: "<status>",

      changeTime: "<datetime>"

}

 |
|

Data Params Description

 |

id -- идентификатор на заявка за плащане

status -- статус на заявката за плащане, възможните стойности са: "PENDING" (Очаква плащане), "AUTHORIZED" (Получена е авторизация от виртуалния ПОС терминал), "ORDERED" (Плащането е наредено), "PAID" (Плащането е получено по сметката на доставчика), "EXPIRED" (Заявката за плащане е изтекла), "CANCELED" (Заявката за плащане е отказана от потребителя), "SUSPENDED" (Заявката за плащане е отказана от АИС)

changeTime  -- време на промяна на статуса на заявката за плащане в ISO 8601 формат

 |
|

Response Content

 |

{

      success: "<Boolean>"

}

 |
|

Response Content Description

 |

В случай на успешно приемане на съобщението се връща резултат "true". Всеки друг резултат се счита за неуспешно приемане.

 |
|

Errors

 |

Няма

 |

Ако информационната система на посоченото URL  за уведомяване не върне отговор, че успешно е получила съобщението Средата продължава да изпраща съобщението по следната схема:

1) 5 опита през < 1 минута

2) 4 опита през 15 минути

3) 5 опита през 1 час

4) 6 опита през 3 часа

5) 4 опита през 6 часа

6) 1 опит на ден

Средата спира да изпраща съобщение за нов статус, ако то не бъде получено в продължение на 30 дена.

### 4.1.10 Плащане с виртуален ПОС  на обслужваща банка или виртуален ПОС на EPAY

- **ВПОС на обслужваща банка**

|

Title

 |

Плащане с виртуален ПОС  на облужваща банка

 |
|

Description

 |

Услугата позволява да се извърши директно плащане от външна система на регистрирана в средата заявка за плащане чрез виртуален ПОС терминал  на обслужващата банка

 |
|

URL

 |

https://portalUrl/vpos/payment

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

{

       id: "<id>",

       okUrl:  "<ok_url>",

       cancelUrl:  "<cancel_url>"

}

 |
|

Data Params Description

 |

id -- идентификатор на заявката, която се плаща

okUrl -- адрес, на който да се върне потребителя при извършване на плащането. Препращане на клиента на това URL  не гарантира, че  авторизацията на плащането е била успешна.

cancelUrl - адрес, на който да се върне потребителя в случай, че плащането е отказано или не е извършено.

 |
|

Response Content

 |

Няма

 |
|

Response Content Description

 |

Няма

 |
|

Errors

 |

Ако в средата не съществува регистрирана заявка за плащане с посоченото id се връща грешка HTTP 400  BAD REQUEST

 |

- **ВПОС на EPAY**

|

Title

 |

Плащане с виртуален ПОС  на EPAY

 |
|

Description

 |

Услугата позволява да се извърши директно плащане от външна система на регистрирана в средата заявка за плащане чрез виртуален ПОС терминал  на обслужващата банка

 |
|

URL

 |

https://portalUrl/vpos/paymentViaEpay

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

{

       id: "<id>",

       okUrl:  "<ok_url>",

       cancelUrl:  "<cancel_url>"

}

 |
|

Data Params Description

 |

id -- идентификатор на заявката, която се плаща

okUrl -- адрес, на който да се върне потребителя при извършване на плащането. Препращане на клиента на това URL  не гарантира, че  авторизацията на плащането е била успешна.

cancelUrl - адрес, на който да се върне потребителя в случай, че плащането е отказано или не е извършено.

 |
|

Response Content

 |

Няма

 |
|

Response Content Description

 |

Няма

 |
|

Errors

 |

Ако в средата не съществува регистрирана заявка за плащане с посоченото id се връща грешка HTTP 400  BAD REQUEST

 |

След въвеждане на необходимите данни във формата на виртуалния ПОС, средата ще извърши автоматична HTTP POST заявка съответно към okUrl или cancelUrl адреса. При POST заявката ще бъдат предадени три параметъра, по аналогичен начин както се изисква да бъдат подавани параметрите за работа с услугите на средата (виж точка 2), а именно:

1) clientId -- тук ще бъде подаден уникалният идентификатора на клиента, който е бил подаден при изначалната заявка към https://portalUrl.com/vpos/payment

2) hmac -- hmac-sha256 код изчислен върху полето data

3) data -- данни за предаваното съобщение.

Параметрите се подават в HTTPS POST заявката в Internet media type формат "application/x-www-form-urlencoded; charset=UTF-8".

Данните за предаваното съобщение в полето "data", както и HMAC-SHA256 кода се изчисляват по същият начин както е описано по-горе в точка 2. Извикване на услуги на средата.

Данните в полето "data" представляват JSON стринг със следната структура:

{

    requestId: "<requestId>",

    vposResultGid: "<vposResultGid>",

    status: "<status>",

    errorMessage: "<errorMessage>",

    resultTime: "<resultTime >"

}

Описание на полетата в "data" JSON стринга:

- requestId - идентификатор на заявката за плащане, за която е направен опит да бъде платена;

- vposResultGid - системен за средата идентификатор на резултата;

- status - статусите на резултата от плащането са: "SUCCESS" (Успешно плащане), "FAILURE" (Неуспешно плащане), "CANCELEDBYUSER" (Отказано от потребителя);

- errorMessage - описание на възникналата грешка (има стойност само когато полето "status" има стойност "failure");

- resultTime - дата и час на получаване на резултата от виртуалния ПОС (ISO 8601 формат).

### 4.1.11 Визуализиране на платежно нареждане

|

Title

 |

Визуализиране на платежно нареждане

 |
|

Description

 |

Чрез услугата автоматично се генерира уеб страница съдържаща форма на платежно нареждане с попълнени необходимите данни за заплащане на задължение по банков път. Препоръчително е АИС да отвори уеб страницата в нов прозорец/таб или IFRAME.

 |
|

URL

 |

[https://portalUrl/ais/paymentOrder](https://portalurl/ais/paymentOrder)

 |
|

Method

 |

POST

 |
|

URL Params

 |

Няма

 |
|

Data Params

 |

{

       id: "<id>"

}

 |
|

Data Params Description

 |

id -- идентификатор на заявката, която се плаща

 |
|

Response Content

 |

Няма

 |
|

Response Content Description

 |

Няма

 |
|

Errors

 |

Ако в средата не съществува регистрирана заявка за плащане с посоченото id се връща грешка HTTP 400  BAD REQUEST

 |

5 Тестова среда
===============

Адресът (serviceUrl) за извикване на услуги на тестовата среда за електронни плащания е: [https://epaymentsapi.abbaty.com:10102](https://epaymentsapi.abbaty.com:10102/)  .

За достъп до услугите за обмен на данни с АИС:

**clientId:** testAisClient

**secretKey:** 8F70C29ACBB38F39B0900C26B3A20B0683E62C97A4E578358904686D0023988D0C9873AD23EE87003B36EE5221617FEC0345E3B1138FE1B57EF5DE4771E3CF42

За достъп до услугите за обмен на данни с обслужващите банки:

**clientId:** testBankClient

**secretKey:** 4E78C4A8564B9204B9D7A06DD799A286F6260742F72700F77631FCCBC0C9497F3E2FF1F6B3DFD5EA7E2224EDCCCE37889B0D9F3AEF5F7E4E69CA7E20675BD255

Адресът (portalUrl) на тестовия портал за електронни плащания е: [https://epayments.abbaty.com:10102/](https://site.abbaty.com:8443/) .
